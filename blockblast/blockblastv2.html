<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BlockBlast Web</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none}
body{
    font-family:Arial, sans-serif;
    background:linear-gradient(160deg,#0f172a,#1e293b,#0f172a);
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding-top:20px;
    overflow:hidden;
}
:root{
    --cell-size:54px;
    --gap:20px;
    --block-color:#4cc9f0;
}
#board{
    width:calc(9 * var(--cell-size) + 8 * var(--gap));
    height:calc(9 * var(--cell-size) + 8 * var(--gap));
    display:grid;
    grid-template-columns:repeat(9, var(--cell-size));
    grid-template-rows:repeat(9, var(--cell-size));
    gap:var(--gap);
    padding:12px;
    background:rgba(255,255,255,0.05);
    border-radius:20px;
    position:relative;
}
.cell{
    width:var(--cell-size);
    height:var(--cell-size);
    border-radius:12px;
    background:rgba(255,255,255,0.08);
    transition:0.15s;
}
.cell.highlight{
    background:rgba(0,255,180,0.45);
    box-shadow:0 0 18px rgba(0,255,180,0.8);
}
.filled{
    background:var(--block-color);
    box-shadow:0 0 8px var(--block-color),0 0 14px var(--block-color);
}
.slots{
    margin-top:25px;
    display:flex;
    gap:20px;
}
.slot{
    width:180px;
    height:180px;
    background:rgba(255,255,255,0.05);
    border-radius:18px;
    display:flex;
    justify-content:center;
    align-items:center;
}
.previewGrid{
    display:inline-grid;
    gap:10px;
}
.previewCell{
    width:32px;
    height:32px;
    border-radius:6px;
    background:var(--block-color);
    box-shadow:0 0 6px var(--block-color);
}
.ghost{
    position:fixed;
    z-index:200;
    pointer-events:none;
    transform:translate(-50%,-50%) scale(1.02);
    background:rgba(255,255,255,0.03);
    padding:6px;
    border-radius:10px;
    filter:drop-shadow(0 10px 25px rgba(0,0,0,0.35));
    will-change:transform,top,left;
}
.scoreBox{
    color:white;
    font-size:32px;
    font-weight:700;
    margin-bottom:10px;
}
.flash{
    position:absolute;
    width:100%;
    height:100%;
    background:white;
    opacity:0;
    top:0;
    left:0;
    z-index:150;
}
@keyframes flashAnim{
    0%{opacity:0}
    20%{opacity:0.9}
    100%{opacity:0}
}
.particle{
    position:absolute;
    width:10px;
    height:10px;
    border-radius:50%;
    background:var(--block-color);
    opacity:1;
    animation:particleAnim 0.6s linear forwards;
}
@keyframes particleAnim{
    0%{transform:scale(1);opacity:1}
    100%{transform:translate(var(--tx), var(--ty)) scale(0.2);opacity:0}
}
#gameOverScreen{
    position:fixed;
    top:0;left:0;
    width:100%;height:100%;
    background:rgba(0,0,0,0.75);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    color:white;
    font-size:40px;
    font-weight:700;
    display:none;
    z-index:300;
}
#restartBtn{
    margin-top:20px;
    padding:12px 26px;
    font-size:22px;
    border:none;
    border-radius:10px;
    background:#38bdf8;
    color:black;
    cursor:pointer;
}
</style>
</head>
<body>

<div class="scoreBox" id="score">0</div>
<div id="board"></div>
<div class="slots">
    <div class="slot" id="slot1"></div>
    <div class="slot" id="slot2"></div>
    <div class="slot" id="slot3"></div>
</div>

<div class="flash" id="flash"></div>

<div id="gameOverScreen">
    GAME OVER
    <button id="restartBtn">Restart</button>
</div>

<script>
const board=document.getElementById("board");
const scoreBox=document.getElementById("score");
const flash=document.getElementById("flash");
let score=0;
let boardState=Array.from({length:9},()=>Array(9).fill(0));
let currentBlocks=[null,null,null];
let ghost=null;
let dragging=false;
let dragBlock=null;
let dragShape=null;
let offsetX=0,offsetY=0;

function initBoard(){
    board.innerHTML="";
    for(let i=0;i<81;i++){
        const c=document.createElement("div");
        c.className="cell";
        board.appendChild(c);
    }
}
initBoard();

const shapes=[
    [[1,1],[1,1]],
    [[1,1,1]],
    [[1],[1],[1]],
    [[1,1,1],[0,1,0]],
    [[1,1],[1,0]],
    [[1,1,1],[1,0,0]],
    [[1,1,1],[0,0,1]],
    [[1,0],[1,0],[1,1]],
    [[1,1,1,1]],
    [[1],[1],[1],[1]],
];
function randomShape(){
    return shapes[Math.floor(Math.random()*shapes.length)];
}
function renderSlots(){
    for(let i=1;i<=3;i++){
        const slot=document.getElementById("slot"+i);
        slot.innerHTML="";
        const shape=randomShape();
        currentBlocks[i-1]=shape;
        const g=document.createElement("div");
        g.className="previewGrid";
        g.style.gridTemplateColumns=`repeat(${shape[0].length},32px)`;
        for(let r=0;r<shape.length;r++){
            for(let c=0;c<shape[0].length;c++){
                if(shape[r][c]==1){
                    const pc=document.createElement("div");
                    pc.className="previewCell";
                    g.appendChild(pc);
                }
            }
        }
        slot.appendChild(g);
        g.onmousedown=e=>startDrag(e, shape, i-1);
        g.ontouchstart=e=>startDrag(e.touches[0], shape, i-1);
    }
}
renderSlots();

function startDrag(e,shape,index){
    dragging=true;dragBlock=index;dragShape=shape;
    ghost=document.createElement("div");
    ghost.className="ghost";
    ghost.style.display="grid";
    ghost.style.gridTemplateColumns=`repeat(${shape[0].length},32px)`;
    for(let r=0;r<shape.length;r++){
        for(let c=0;c<shape[0].length;c++){
            if(shape[r][c]==1){
                const d=document.createElement("div");
                d.style.width="32px";
                d.style.height="32px";
                d.style.borderRadius="6px";
                d.style.background="var(--block-color)";
                d.style.boxShadow="0 0 6px var(--block-color)";
                ghost.appendChild(d);
            }
        }
    }
    document.body.appendChild(ghost);
    moveGhost(e);
}

document.onmousemove=e=>{ if(dragging) moveGhost(e); };
document.ontouchmove=e=>{ if(dragging) moveGhost(e.touches[0]); };
document.onmouseup=()=> drop();
document.ontouchend=()=> drop();

function moveGhost(e){
    ghost.style.left=e.clientX+"px";
    ghost.style.top=e.clientY+"px";
}

function drop(){
    if(!dragging)return;
    dragging=false;
    ghost.remove();
    const rect=board.getBoundingClientRect();
    const cx=event.clientX-rect.left;
    const cy=event.clientY-rect.top;
    const col=Math.floor(cx/(54+20));
    const row=Math.floor(cy/(54+20));
    if(placeBlock(row,col)){
        currentBlocks[dragBlock]=null;
        document.getElementById("slot"+(dragBlock+1)).innerHTML="";
        if(currentBlocks.every(x=>x==null)) renderSlots();
    }
}

function placeBlock(r,c){
    const s=dragShape;
    if(r<0||c<0||r+s.length>9||c+s[0].length>9) return false;
    for(let i=0;i<s.length;i++){
        for(let j=0;j<s[0].length;j++){
            if(s[i][j]==1 && boardState[r+i][c+j]==1) return false;
        }
    }
    for(let i=0;i<s.length;i++){
        for(let j=0;j<s[0].length;j++){
            if(s[i][j]==1){
                boardState[r+i][c+j]=1;
            }
        }
    }
    score+=countCells(s)*7;
    updateBoard();
    clearLines();
    checkGameOver();
    return true;
}

function countCells(s){
    let c=0;
    for(let r of s) for(let v of r) if(v==1) c++;
    return c;
}

function updateBoard(){
    const cells=board.children;
    let k=0;
    for(let i=0;i<9;i++){
        for(let j=0;j<9;j++){
            cells[k].classList.toggle("filled", boardState[i][j]==1);
            k++;
        }
    }
    scoreBox.textContent=score;
}

function clearLines(){
    let fullRows=[],fullCols=[];
    for(let i=0;i<9;i++) if(boardState[i].every(v=>v==1)) fullRows.push(i);
    for(let j=0;j<9;j++){
        let ok=true;
        for(let i=0;i<9;i++) if(boardState[i][j]==0) ok=false;
        if(ok) fullCols.push(j);
    }
    if(fullRows.length==0 && fullCols.length==0) return;

    flash.style.animation="flashAnim 0.4s";
    setTimeout(()=>flash.style.animation="",400);

    for(let r of fullRows){
        for(let j=0;j<9;j++){
            spawnParticle(r,j);
            boardState[r][j]=0;
        }
    }
    for(let c of fullCols){
        for(let i=0;i<9;i++){
            spawnParticle(i,c);
            boardState[i][c]=0;
        }
    }

    let combo=fullRows.length+fullCols.length;
    score+=combo*100;
    if(fullRows.length>0 && fullCols.length>0) score+=150;
    if(combo>=4) score+=500;

    updateBoard();
}

function spawnParticle(i,j){
    const p=document.createElement("div");
    p.className="particle";
    const tx=(Math.random()*200-100)+"px";
    const ty=(Math.random()*200-100)+"px";
    p.style.setProperty("--tx",tx);
    p.style.setProperty("--ty",ty);
    const rect=board.children[i*9+j].getBoundingClientRect();
    p.style.left=rect.left+"px";
    p.style.top=rect.top+"px";
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),600);
}

function checkGameOver(){
    for(let shape of currentBlocks){
        if(shape && canPlaceAnywhere(shape)) return;
    }
    gameOver();
}

function canPlaceAnywhere(s){
    for(let r=0;r<9;r++){
        for(let c=0;c<9;c++){
            if(r+s.length<=9 && c+s[0].length<=9){
                let ok=true;
                for(let i=0;i<s.length;i++){
                    for(let j=0;j<s[0].length;j++){
                        if(s[i][j]==1 && boardState[r+i][c+j]==1) ok=false;
                    }
                }
                if(ok) return true;
            }
        }
    }
    return false;
}

function gameOver(){
    document.getElementById("gameOverScreen").style.display="flex";
}

document.getElementById("restartBtn").onclick=()=>{
    score=0;
    boardState=Array.from({length:9},()=>Array(9).fill(0));
    document.getElementById("gameOverScreen").style.display="none";
    updateBoard();
    renderSlots();
};
</script>
</body>
</html>
